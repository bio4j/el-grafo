<!DOCTYPE html>
<meta charset="utf-8">
<title> Bio4j model scheme </title>

<style>




.link {
  fill: none;
  stroke: grey;
  stroke-dasharray: 2, 3;
  stroke-width: 1;
}



/* Ignora los labels en mouse hover */
svg text {
        pointer-events: none;
}

</style>
<body>

<script src="http://d3js.org/d3.v3.min.js"></script>

<script>

//TO DEFINE THE COLOR PALETTE:
var bio4jColors = ["#1BCAFF","#587680","#16A2CC","#68DCFF","#0E6580 ","#1BCAFF","#587680"];

var color = d3.scale.category10()
    .range(bio4jColors);

//Width and height
var w = 960,
    h = 700;

//Force layout
var force = d3.layout.force()
    .linkDistance(25)
    .linkStrength(1)
    .charge(-150)
    .size([w, h]);

//Create SVG element
var svg = d3.select("body")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

  //Uploading json file
  d3.json("data/rev_schema_forceLayout.json", function(error, graph) {
  var nodes = graph.nodes.slice(),
      links = [],
      bilinks = [];

  graph.links.forEach(function(link) {
    var s = nodes[link.source],
        t = nodes[link.target],
        i = {};                   // intermediate node
    nodes.push(i);
    links.push({source: s, target: i}, {source: i, target: t});
    bilinks.push([s, i, t]);
  });

  force
      .nodes(nodes)
      .links(links)
      .start();



 //Draw NODES as CIRCLES    
  var node = svg.selectAll(".node")
      .data(graph.nodes)
      .enter()
      .append("circle")
      .attr("class", "node")

      // .attr("r", function(d) { return ((+d.vertexTypesLength) + (+d.edgeTypesLength)); })
      .attr("r", function(d) { return 5 +(+d.vertexTypesLength)})

      .style("fill", function(d, i) { return color(i); })
      .style("opacity", .5)
/*      .on("click", click)
      .on("dblclick", dblclick)*/
      .call(force.drag);

// console.log(function(graph.nodes) return {vertexTypesLength(1)});

  //Draw LINKS as PATHS    
  var link = svg.selectAll(".link")
      .data(bilinks)
      .enter()
      .append("path")
      .attr("class", "link");

  //Labels vertex
  var labelsVertex = svg.selectAll("text1")
         .data(graph.nodes)
         .enter()
         .append("text")
         .text(function(d) { return d.label; })
         .attr("x", function(d) { return d.x; })
         .attr("y", function(d) { return d.y; })
         .attr("text-anchor", "middle")
         .attr("font-family", "sans-serif")
         .attr("font-size", "11px")
         .attr("fill", "black");
         //.remove();

   
  //Labels edges
  var labelsEdges = svg.selectAll("text3")
         .data(graph.links)
         .enter()
         .append("text")
         .attr("text-anchor", "middle")
         .text(function(d) { return d.label; })
         .attr("x", function(d) { return d.source.x; })
         .attr("y", function(d) { return d.source.y; })
         .attr("font-family", "sans-serif")
         .attr("font-size", "8px")
         .attr("fill", "grey")
         // .remove();



  force.on("tick", function() {


    link.attr("d", function(d) {
      return "M" + d[0].x + "," + d[0].y
          + "S" + d[1].x + "," + d[1].y 
          + " " + d[2].x + "," + d[2].y;
    });
   


    node.attr("transform", function(d) {
      return "translate(" + d.x + "," + d.y + ")";
    });


    labelsVertex.attr("x", function(d) { return d.x; })       
                .attr("y", function(d) { return d.y + 3; }); 

/*    labelsEdges.attr("x", function(d) { return ((d.source.x + d.target.x)/2); })       
                .attr("y", function(d) { return ((d.source.y + d.target.y)/2); });  */

  });


// action to take on mouse click
/*function click() {
    d3.select(this).select("text1").transition()
        .duration(750)
        .attr("x", 22)
        .style("fill", "steelblue")
        .style("stroke", "lightsteelblue")
        .style("stroke-width", ".5px")
        .style("font", "20px sans-serif");
    d3.select(this).select("circle").transition()
        .duration(750)
        .attr("r", 16)
        .style("fill", "lightsteelblue");
}

// action to take on mouse double click
function dblclick() {
    d3.select(this).select("circle").transition()
        .duration(750)
        .attr("r", 6)
        .style("fill", "#ccc");
    d3.select(this).select("text1").transition()
        .duration(750)
        .attr("x", 12)
        .style("stroke", "none")
        .style("fill", "black")
        .style("stroke", "none")
        .style("font", "10px sans-serif");
}*/



//////////////////////////////////////////////////////

//ConvexHull
/*var groupPath = function(d) {
    return "M" + 
      d3.geom.hull(d.values.map(function(i) { return [i.x, i.y]; }))
        .join("L")
    + "Z";
};

  svg.selectAll("path")
    .data(graph)
      .attr("d", groupPath)
      .enter().insert("path", "circle")
      .style("fill", "red")
      .style("stroke", "red")
      .style("stroke-width", 20)
      .style("stroke-linejoin", "round")
      .style("opacity", .2)
      .attr("d", groupPath);*/
/*});*/

});

</script>